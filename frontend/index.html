<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Совет директоров — тест</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    textarea { width: 100%; height: 80px; }
    button { margin-top: 10px; padding: 6px 12px; }
    .results { margin-top: 20px; }
    .agent { border: 1px solid #ccc; padding: 8px; margin-bottom: 8px; }
    .agent-title { font-weight: bold; margin-bottom: 4px; }
  </style>
</head>
<body>
  <h1>Совет директоров (GigaChat)</h1>

  <label for="message">Ваш запрос:</label><br />
  <textarea id="message" placeholder="Напишите сюда задачу или идею"></textarea><br />
  <button id="sendBtn">Отправить</button>

  <div id="status"></div>

  <div class="results" id="results"></div>

  <script>
    const endpoint = "http://localhost:8000/api/board"; // поправь при необходимости

    const agentTitles = {
      ceo: "CEO",
      cfo: "CFO",
      cpo: "CPO",
      marketing: "Маркетинг-директор",
      skeptic: "Скептический инвестор"
    };

    document.getElementById("sendBtn").addEventListener("click", async () => {
      const message = document.getElementById("message").value.trim();
      const statusEl = document.getElementById("status");
      const resultsEl = document.getElementById("results");

      resultsEl.innerHTML = "";
      if (!message) {
        statusEl.textContent = "Введите текст запроса.";
        return;
      }

      statusEl.textContent = "Отправка запроса...";
      try {
        const resp = await fetch(endpoint, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ message: message })
        });

        if (!resp.ok) {
          const text = await resp.text();
          statusEl.textContent = "Ошибка: " + resp.status + " " + text;
          return;
        }

        const data = await resp.json(); // ожидается массив {agent, text}
        statusEl.textContent = "Готово.";

        data.forEach(item => {
          const div = document.createElement("div");
          div.className = "agent";

          const title = document.createElement("div");
          title.className = "agent-title";
          title.textContent = agentTitles[item.agent] || item.agent;

          const text = document.createElement("div");
          text.textContent = item.text;

          div.appendChild(title);
          div.appendChild(text);
          resultsEl.appendChild(div);
        });
      } catch (e) {
        statusEl.textContent = "Ошибка сети или JS: " + e;
      }
    });
  </script>
</body>
</html>
