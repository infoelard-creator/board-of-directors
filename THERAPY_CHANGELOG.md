# CHANGELOG: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –°–ª–æ—è –¢–µ—Ä–∞–ø–µ–≤—Ç–∞ –¥–ª—è Clarity Feedback Loop

## 2025-01-06

### ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

**–®–∞–≥ 1: –î–æ–±–∞–≤–ª–µ–Ω—ã –º–æ–¥–µ–ª–∏ –ë–î –¥–ª—è –¢–µ—Ä–∞–ø–µ–≤—Ç–∞ –≤ `db.py`**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `therapy_sessions` ‚Äî —Å–µ—Å—Å–∏–∏ –¥–∏–∞–ª–æ–≥–∞ —Å –¢–µ—Ä–∞–ø–µ–≤—Ç–æ–º
  - –•—Ä–∞–Ω–∏—Ç –∏—Å—Ö–æ–¥–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É, —Å—Ç–∞—Ç—É—Å, —Ñ–∏–Ω–∞–ª—å–Ω—É—é –≥–∏–ø–æ—Ç–µ–∑—É
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `therapy_messages` ‚Äî –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è Q&A
  - –î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞
  - –ü–æ–ª–µ: `message_metadata` (JSON –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `therapy_key_insights` ‚Äî –∫–ª—é—á–µ–≤—ã–µ –∑–Ω–∞–Ω–∏—è
  - –û–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ "–ë—é–¥–∂–µ—Ç: 50K –†–£–ë"
  - –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (`is_deleted_by_user`)
  - –ü–æ–ª—è: `confidence`, `importance`, `display_order`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `therapy_hypotheses` ‚Äî –≥–∏–ø–æ—Ç–µ–∑—ã —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º
  - –•—Ä–∞–Ω–∏—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∏ JSON –≤–∞—Ä–∏–∞–Ω—Ç—ã
  - –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç confidence (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ –±–∞–±–±–ª–∞—Ö –µ—Å–ª–∏ ‚â• 85%)

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `db.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã 4 –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ + —Å–≤—è–∑–∏ —Å User
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞: –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω `metadata` –Ω–∞ `message_metadata` (–∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–º—è –≤ SQLAlchemy)
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ `.env` —á–µ—Ä–µ–∑ `python-dotenv`
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `DATABASE_URL`

**–û–∫—Ä—É–∂–µ–Ω–∏–µ:**
- Codespaces –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SQLite (`sqlite:///./test.db`)
- –ù–∞ –ü—Ä–æ–º-—Å–µ—Ä–≤–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PostgreSQL (`postgresql+psycopg2://...`)
- `python-dotenv==1.0.0` —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ DATABASE_URL –∑–∞–≥—Ä—É–∂–µ–Ω–∞: `sqlite:///./test.db`
- ‚úÖ –ë–î –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ –í—Å–µ 5 —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ

**–ó–∞—á–µ–º:**
–§—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–æ–π —Å–µ—Å—Å–∏–∏ –≤ –ë–î. –ì–æ—Ç–æ–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±—ç–∫–µ–Ω–¥ –ª–æ–≥–∏–∫–∏.

---

### üöß –°–õ–ï–î–£–Æ–©–ï–ï

**–®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å `/api/therapy` —ç–Ω–¥–ø–æ–∏–Ω—Ç** (–°–õ–ï–î–£–Æ–©–ï–ï)
- –°–æ–∑–¥–∞—Ç—å `app/routes/therapy.py`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –¥–∏–∞–ª–æ–≥–∞ —Å –¢–µ—Ä–∞–ø–µ–≤—Ç–æ–º
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç –¢–µ—Ä–∞–ø–µ–≤—Ç–∞ –≤ `app/services/prompts.py`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º —Å–∂–∞—Ç–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

### üìã TODO

- [ ] –°–æ–∑–¥–∞—Ç—å `/api/therapy` —ç–Ω–¥–ø–æ–∏–Ω—Ç
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º —Å–∂–∞—Ç–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–ø–µ—Ä–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞ + –∫–ª—é—á–µ–≤—ã–µ –∑–Ω–∞–Ω–∏—è + –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –∞–Ω–∞–ª–∏–∑–∞ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∏–Ω—Å–∞–π—Ç–æ–≤ (–í–∞—Ä–∏–∞–Ω—Ç B ‚Äî –Ω–µ—è–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑)
- [ ] –§—Ä–æ–Ω—Ç–µ–Ω–¥: –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∂–∏–º Therapy
- [ ] –§—Ä–æ–Ω—Ç–µ–Ω–¥: –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å Key Insights –∏ Hypotheses
- [ ] –§—Ä–æ–Ω—Ç–µ–Ω–¥: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É Therapy –∏ Board
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ live data
- [ ] –î–µ–ø–ª–æ–π –Ω–∞ –ü—Ä–æ–º-—Å–µ—Ä–≤–µ—Ä

---

### üìù –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –†–ï–®–ï–ù–ò–Ø

**–ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –¢–µ—Ä–∞–ø–µ–≤—Ç–∞ (–¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤):**
1. –ò–°–•–û–î–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê (–ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
2. –ö–õ–Æ–ß–ï–í–´–ï –ó–ù–ê–ù–ò–Ø (–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ importance)
3. –£–î–ê–õ–Å–ù–ù–´–ï –ó–ù–ê–ù–ò–Ø (—Å–∫—Ä—ã—Ç–æ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ–º–µ—á–µ–Ω–æ –∫–∞–∫ "was_deleted_by_user")
4. –ü–û–°–õ–ï–î–ù–ò–ï 10 –°–û–û–ë–©–ï–ù–ò–ô (raw —Ç–µ–∫—Å—Ç)
5. –¢–ï–ö–£–©–ò–ô –û–¢–í–ï–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø

**–£–¥–∞–ª–µ–Ω–∏–µ Key Insights:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –±–∞–±–±–ª —Å [‚úï] –∏ –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –∑–Ω–∞–Ω–∏–µ
- –¢–µ—Ä–∞–ø–µ–≤—Ç –≤–∏–¥–∏—Ç —É–¥–∞–ª—ë–Ω–Ω–æ–µ –∑–Ω–∞–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ (–í–∞—Ä–∏–∞–Ω—Ç B)
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –µ–≥–æ –≤–∞–∂–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ—Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–µ–ª–∏–∫–∞—Ç–Ω–æ

**–ì–∏–ø–æ—Ç–µ–∑—ã:**
- –¢–µ—Ä–∞–ø–µ–≤—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 5-10 –≥–∏–ø–æ—Ç–µ–∑
- –¢–æ–ª—å–∫–æ –≥–∏–ø–æ—Ç–µ–∑—ã —Å confidence ‚â• 85% –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –±–∞–±–±–ª–∞—Ö
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å –∏ —É–≤–∏–¥–µ—Ç—å –≤—Å–µ –≥–∏–ø–æ—Ç–µ–∑—ã (5-10) –æ—Ç—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ confidence


---

### ‚úÖ –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç /api/therapy –∏ –ø—Ä–æ–º–ø—Ç—ã –¢–µ—Ä–∞–ø–µ–≤—Ç–∞

**–§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã/–∏–∑–º–µ–Ω–µ–Ω—ã:**
- `app/routes/therapy.py` (12K) ‚Äî –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ —Å –¢–µ—Ä–∞–ø–µ–≤—Ç–æ–º
  - –ö–ª–∞—Å—Å `TherapyRequest` ‚Äî –∫–æ–Ω—Ç—Ä–∞–∫—Ç –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (session_id –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞)
  - –ö–ª–∞—Å—Å `TherapyResponse` ‚Äî –∫–æ–Ω—Ç—Ä–∞–∫—Ç –æ—Ç–≤–µ—Ç–∞ (therapist_message, key_insights, hypotheses, ready_for_board)
  - –§—É–Ω–∫—Ü–∏—è `get_therapy_context()` ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã, –∫–ª—é—á–µ–≤—ã—Ö –∑–Ω–∞–Ω–∏–π, –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
  - –≠–Ω–¥–ø–æ–∏–Ω—Ç `POST /api/therapy` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    - –≠—Ç–∞–ø 1: —Å–æ–∑–¥–∞–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ TherapySession
    - –≠—Ç–∞–ø 2: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - –≠—Ç–∞–ø 3: –≤—ã–∑–æ–≤ –¢–µ—Ä–∞–ø–µ–≤—Ç–∞ (—Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
    - –≠—Ç–∞–ø 4: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –¢–µ—Ä–∞–ø–µ–≤—Ç–∞
    - –≠—Ç–∞–ø 5: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–∏–ø–æ—Ç–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º (–í–∞—Ä–∏–∞–Ω—Ç B)
    - –≠—Ç–∞–ø 6: —Å–±–æ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ —Å insights –∏ hypotheses

- `app/services/prompts.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–º–ø—Ç—ã –¢–µ—Ä–∞–ø–µ–≤—Ç–∞
  - `THERAPY_PARAMS` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã LLM –¥–ª—è –¢–µ—Ä–∞–ø–µ–≤—Ç–∞ (temperature 0.7, max_tokens 200)
  - `THERAPY_SYSTEM_PROMPT` ‚Äî –ø—Å–∏—Ö–æ–ª–æ–≥-–±–∏–∑–Ω–µ—Å-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç (–¥—Ä—É–∂–µ—Å–∫–∏–π —Ç–æ–Ω, 1-2 –≤–æ–ø—Ä–æ—Å–∞, —Ñ–æ–∫—É—Å –Ω–∞ –ø—Ä–æ–±–ª–µ–º–µ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö)
  - `HYPOTHESIS_GENERATOR_SYSTEM_PROMPT` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä 3-5 –≥–∏–ø–æ—Ç–µ–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –¢–µ—Ä–∞–ø–µ–≤—Ç–∞ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤):
  1. –ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ (–ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
  2. –ö–ª—é—á–µ–≤—ã–µ –∑–Ω–∞–Ω–∏—è (–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ importance)
  3. –£–¥–∞–ª—ë–Ω–Ω—ã–µ –∑–Ω–∞–Ω–∏—è (—Å–∫—Ä—ã—Ç–æ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –í–∞—Ä–∏–∞–Ω—Ç B)
  4. –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π (raw —Ç–µ–∫—Å—Ç)
  5. –¢–µ–∫—É—â–∏–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–∏–ø–æ—Ç–µ–∑ (–í–∞—Ä–∏–∞–Ω—Ç B):
  - –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å: –¢–µ—Ä–∞–ø–µ–≤—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç
  - –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç –≥–∏–ø–æ—Ç–µ–∑—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—Ç–∞

- –£—Å–ª–æ–≤–∏–µ show hypotheses:
  - –ï—Å–ª–∏ –µ—Å—Ç—å –≥–∏–ø–æ—Ç–µ–∑–∞ —Å confidence ‚â• 85% ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë –≤ –±–∞–±–±–ª–∞—Ö
  - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –±–∞–±–±–ª "—è —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É—é –≥–∏–ø–æ—Ç–µ–∑—É —Å–∞–º" (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Board —Å –ø—É—Å—Ç—ã–º –ø–æ–ª–µ–º)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –§–∞–π–ª `app/routes/therapy.py` —Å–æ–∑–¥–∞–Ω (12K)
- ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å Python –≤ `prompts.py` –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- ‚úÖ –ü—Ä–æ–º–ø—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ (–Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã)

**TODO –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ:**
- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—É—Ç–µ—Ä therapy –≤ main.py
- [ ] –î–æ–±–∞–≤–∏—Ç—å THERAPY_PARAMS –≤ AGENT_PARAMS (–¥–ª—è ask_gigachat)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –ª–æ–∫–∞–ª—å–Ω–æ


---

### ‚úÖ –®–∞–≥ 2.2-2.4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è therapy_router –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `main.py` (—Å—Ç—Ä–æ–∫–∞ 16) ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç therapy_router
- `main.py` (—Å—Ç—Ä–æ–∫–∞ 64) ‚Äî –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω app.include_router(therapy_router)
- `app/routes/__init__.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç –∏ —ç–∫—Å–ø–æ—Ä—Ç therapy_router
- `app/services/prompts.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã "therapy" –∏ "therapy_hypothesis_generator" –≤ AGENT_PARAMS

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ therapy_router –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ main.py
- ‚úÖ therapy_router –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –∫–∞–∫ /api/therapy
- ‚úÖ AGENT_PARAMS —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –¢–µ—Ä–∞–ø–µ–≤—Ç–∞
- ‚úÖ –í—Å–µ –ø—Ä–æ–º–ø—Ç—ã (THERAPY_SYSTEM_PROMPT, HYPOTHESIS_GENERATOR_SYSTEM_PROMPT) –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã

**–°—Ç–∞—Ç—É—Å:**
- ‚úÖ –ë—ç–∫–µ–Ω–¥ –¥–ª—è /api/therapy –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤
- ‚è≥ –ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (UI –¥–ª—è —Ä–µ–∂–∏–º–∞ Therapy)
- ‚è≥ –ù—É–∂–Ω–∞ –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å Key Insights –∏ Hypotheses

**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:**
–®–∞–≥ 3: –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∂–∏–º Therapy –∏ –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å

# Therapy Frontend Module - CHANGELOG

**–í–µ—Ä—Å–∏—è:** 1.0.0
**–î–∞—Ç–∞:** 2026-01-06
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Frontend Complete, Backend Pending

---

## üìã OVERVIEW

–ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è **Therapy –º–æ–¥—É–ª—è** (–°–ª–æ–π 1 –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Clarity Feedback Loop) –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ.

–ú–æ–¥—É–ª—å –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º AI-native –∫–æ–º–ø–∞–Ω–∏–π:
- –û–ø–∏—Å–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É –≤ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ
- –ü–æ–ª—É—á–∏—Ç—å —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –æ—Ç –¢–µ—Ä–∞–ø–µ–≤—Ç–∞-–∞–≥–µ–Ω—Ç–∞
- –£–≤–∏–¥–µ—Ç—å –∫–ª—é—á–µ–≤—ã–µ insights –∏ –≥–∏–ø–æ—Ç–µ–∑—ã
- –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ Board —Å —á–µ—Ç–∫–æ–π –≥–∏–ø–æ—Ç–µ–∑–æ–π –¥–ª—è –ò–ò-–∞–≥–µ–Ω—Ç–æ–≤

---

## üöÄ WHAT'S NEW (v1.0.0)

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã (6 –º–æ–¥—É–ª–µ–π)

#### 1. **frontend/js/therapy-api.js** (61 —Å—Ç—Ä–æ–∫–∞, 2.1K)
- `sendTherapyMessage(sessionId, userMessage, authToken)` - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ /api/therapy
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏ –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –ø—Ä–∏ —Å–±–æ–µ

#### 2. **frontend/js/therapy-mode.js** (122 —Å—Ç—Ä–æ–∫–∏, 3.8K)
- `initTherapySession()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é Therapy
- `transitionToBoard(hypothesis)` - –ø–µ—Ä–µ—Ö–æ–¥ –∏–∑ Therapy –≤ Board —Ä–µ–∂–∏–º
- `updateReadyForBoardFlag()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ Board
- State management –¥–ª—è Therapy –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

#### 3. **frontend/js/ui/therapy-chat.js** (85 —Å—Ç—Ä–æ–∫, 3.1K)
- `addTherapistMessage(message)` - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –¢–µ—Ä–∞–ø–µ–≤—Ç–∞ –≤ —á–∞—Ç–µ
- `clearTherapyChat()` - –æ—á–∏—â–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞
- `getTherapyMessages()` - –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º —á–∞—Ç-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º

#### 4. **frontend/js/ui/therapy-panel.js** (246 —Å—Ç—Ä–æ–∫, 8.6K)
- `initTherapyPanel()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å
- `updateInsightsList(insights)` - —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Å–ø–∏—Å–æ–∫ insights
- `updateHypothesesList(hypotheses)` - —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Å–ø–∏—Å–æ–∫ –≥–∏–ø–æ—Ç–µ–∑
- `deleteInsight(insightId)` - —É–¥–∞–ª—è–µ—Ç insight –∏–∑ –ø–∞–Ω–µ–ª–∏
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π (send to board, formulate own, continue)
- –°—á–µ—Ç—á–∏–∫ conversations turns

#### 5. **frontend/js/ui/therapy-bubbles.js** (179 —Å—Ç—Ä–æ–∫, 6.2K)
- `initBubblesContainer()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –±–∞–±–±–ª–∞–º–∏
- `showBubbles()` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
- `updateBubblesState()` - –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–±–±–ª–æ–≤
- 3 —Ç–∏–ø–∞ –¥–µ–π—Å—Ç–≤–∏–π:
1. "üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–æ–≤–µ—Ç" (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–∏–ø–æ—Ç–µ–∑—É –Ω–∞ Board)
2. "‚úçÔ∏è –Ø —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É—é –≥–∏–ø–æ—Ç–µ–∑—É —Å–∞–º" (–ø–µ—Ä–µ—Ö–æ–¥ –≤ Board —Ä–µ–∂–∏–º)
3. "üí¨ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–∏–∞–ª–æ–≥" (–æ—Å—Ç–∞–µ—Ç—Å—è –≤ Therapy)

#### 6. **frontend/styles/therapy.css** (316 —Å—Ç—Ä–æ–∫, 6.3K)
- –ü–æ–ª–Ω–∞—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è Therapy UI
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω (–º–æ–±–∏–ª—å–Ω—ã–µ + –¥–µ—Å–∫—Ç–æ–ø)
- –¢—ë–º–Ω—ã–π —Ä–µ–∂–∏–º –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (fade-in, slide, pulse)
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `.therapy-chat-container` - —á–∞—Ç-–æ–±–ª–∞—Å—Ç—å
- `.therapist-message` - —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–µ—Ä–∞–ø–µ–≤—Ç–∞ (—Å emoji, —Ü–≤–µ—Ç–æ–º)
- `.therapy-panel` - –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å insights
- `.therapy-bubbles` - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
- `.insight-item`, `.hypothesis-item` - —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–æ–≤

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

#### **frontend/index.html**

‚úÖ –î–æ–±–∞–≤–ª–µ–Ω <link> –Ω–∞ therapy.css (—Å—Ç—Ä–æ–∫–∞ 13)
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã 5 –∏–º–ø–æ—Ä—Ç–æ–≤ Therapy –º–æ–¥—É–ª–µ–π (—Å—Ç—Ä–æ–∫–∏ 77-81)
text

#### **frontend/js/app.js** (378 —Å—Ç—Ä–æ–∫, –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª–µ–Ω)

‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã 5 –∏–º–ø–æ—Ä—Ç–æ–≤ Therapy (—Å—Ç—Ä–æ–∫–∏ 21-25)
‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Therapy –≤ init() (—Å—Ç—Ä–æ–∫–∏ 44-46)
‚úÖ setupTherapyEventListeners() (—Å—Ç—Ä–æ–∫–∏ 62-97)
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ handleSendMessage() —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–≤—É—Ö —Ä–µ–∂–∏–º–æ–≤:
inTherapyMode = true ‚Üí POST /api/therapy
inTherapyMode = false ‚Üí POST /api/board (–∫–∞–∫ –±—ã–ª–æ)
text

#### **frontend/js/state.js**

‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Therapy —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º:
isTherapyMode() / setTherapyMode()
getTherapySessionId() / setTherapySessionId()
getTherapyInsights() / setTherapyInsights()
getTherapyHypotheses() / setTherapyHypotheses()
removeTherapyInsightById()
text

---

## üìä STATISTICS

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –ù–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ | 6 |
| –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ | 3 |
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ (Therapy) | 1009 |
| CSS —Å—Ç—Ä–æ–∫ | 316 |
| JS —Å—Ç—Ä–æ–∫ | 693 |
| –†–∞–∑–º–µ—Ä –º–æ–¥—É–ª—è | 30.1K |
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ UI | 5 |
| Event listeners | 4 |
| API –º–µ—Ç–æ–¥–æ–≤ | 1 –æ—Å–Ω–æ–≤–Ω–æ–π + –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ |

---

## üîÑ WORKFLOW: THERAPY ‚Üí BOARD


‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. THERAPY –†–ï–ñ–ò–ú (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ) ‚îÇ
‚îÇ ‚îî‚îÄ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç: —á–∞—Ç + –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å + –±–∞–±–±–ª—ã ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ü–ò–®–ï–¢ –ü–†–û–ë–õ–ï–ú–£ ‚îÇ
‚îÇ "–•–æ—á—É —Å–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ä—Ç–∞–ø, –Ω–æ –Ω–µ –∑–Ω–∞—é —Å —á–µ–≥–æ –Ω–∞—á–∞—Ç—å" ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. sendTherapyMessage() ‚Üí POST /api/therapy ‚îÇ
‚îÇ ‚îú‚îÄ session_id: –Ω–æ–≤—ã–π –∏–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π ‚îÇ
‚îÇ ‚îî‚îÄ user_message: —Ç–µ–∫—Å—Ç –ø—Ä–æ–±–ª–µ–º—ã ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. BACKEND –û–ë–†–ê–ë–ê–¢–´–í–ê–ï–¢ ‚îÇ
‚îÇ ‚îú‚îÄ –¢–µ—Ä–∞–ø–µ–≤—Ç-–∞–≥–µ–Ω—Ç: —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å ‚îÇ
‚îÇ ‚îú‚îÄ Insights: –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã ‚îÇ
‚îÇ ‚îú‚îÄ Hypotheses: 3-5 –≥–∏–ø–æ—Ç–µ–∑ —Ä–µ—à–µ–Ω–∏—è ‚îÇ
‚îÇ ‚îî‚îÄ ready_for_board: –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ Board ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 5. UI –û–ë–ù–û–í–õ–Ø–ï–¢–°–Ø ‚îÇ
‚îÇ ‚îú‚îÄ addTherapistMessage() - —Å–æ–æ–±—â–µ–Ω–∏–µ –¢–µ—Ä–∞–ø–µ–≤—Ç–∞ ‚îÇ
‚îÇ ‚îú‚îÄ updateInsightsList() - —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–±–ª–µ–º ‚îÇ
‚îÇ ‚îú‚îÄ updateHypothesesList() - —Å–ø–∏—Å–æ–∫ –≥–∏–ø–æ—Ç–µ–∑ ‚îÇ
‚îÇ ‚îî‚îÄ updateBubblesState() - –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∫–Ω–æ–ø–∫–∏ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 6. –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –í–´–ë–ò–†–ê–ï–¢ –î–ï–ô–°–¢–í–ò–ï ‚îÇ
‚îÇ ‚îú‚îÄ Option A: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–∏–ø–æ—Ç–µ–∑—É –Ω–∞ Board ‚îÇ
‚îÇ ‚îú‚îÄ Option B: –°—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≥–∏–ø–æ—Ç–µ–∑—É —Å–∞–º ‚îÇ
‚îÇ ‚îî‚îÄ Option C: –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–∏–∞–ª–æ–≥ —Å –¢–µ—Ä–∞–ø–µ–≤—Ç–æ–º ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚Üì ‚Üì ‚Üì ‚Üì
(A) BOARD (B) BOARD (C) THERAPY (fallback)
(with hyp) (empty input) (continue) (error)
text

---

## üß™ EVENT LISTENERS (Custom Events)

### 1. therapySendToBoard
```javascript
document.addEventListener('therapySendToBoard', (e) => {
const hypothesis = e.detail.hypothesis;
// ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –≤ Board —Ä–µ–∂–∏–º —Å –≥–∏–ø–æ—Ç–µ–∑–æ–π
// ‚Üí messageInput.value = hypothesis.hypothesis_text
});

2. therapyFormulateOwn
javascript
document.addEventListener('therapyFormulateOwn', (e) => {
// ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –≤ Board —Ä–µ–∂–∏–º —Å –ø—É—Å—Ç—ã–º –ø–æ–ª–µ–º
// ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç —Å–≤–æ—é –≥–∏–ø–æ—Ç–µ–∑—É
});

3. therapyContinueDialogue
javascript
document.addEventListener('therapyContinueDialogue', (e) => {
// ‚Üí –û—Å—Ç–∞–µ—Ç—Å—è –≤ Therapy —Ä–µ–∂–∏–º–µ
// ‚Üí messageInput.focus() –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
});

4. therapyInsightDelete
javascript
document.addEventListener('therapyInsightDelete', (e) => {
const insightId = e.detail.insightId;
// ‚Üí –£–¥–∞–ª—è–µ—Ç insight –∏–∑ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
// ‚Üí appState.removeTherapyInsightById(insightId)
});



üé® UI COMPONENTS
Therapy Chat Container
–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–ø—Ä–∞–≤–∞, —Å–µ—Ä—ã–µ)
–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¢–µ—Ä–∞–ø–µ–≤—Ç–∞ (—Å–ª–µ–≤–∞, —Ü–≤–µ—Ç–Ω—ã–µ —Å emoji)
–°–∫—Ä–æ–ª–ª –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
–§—É–Ω–∫—Ü–∏—è clearTherapyChat() –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
Therapy Panel (–±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å)
Insights Section (–ª–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞)
–°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º
Confidence score (%)
–ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è (√ó)
Hypotheses Section (–ø—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞)
–°–ø–∏—Å–æ–∫ –≥–∏–ø–æ—Ç–µ–∑ —Ä–µ—à–µ–Ω–∏—è
Reasoning (–ø–æ—á–µ–º—É —ç—Ç–∞ –≥–∏–ø–æ—Ç–µ–∑–∞)
Next Questions (—Å–ª–µ–¥—É—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã)
Confidence score (%)
Turn Counter - –Ω–æ–º–µ—Ä —Ä–∞—É–Ω–¥–∞ –¥–∏–∞–ª–æ–≥–∞
Therapy Bubbles (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏)
–ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤–Ω–∏–∑—É –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ –¢–µ—Ä–∞–ø–µ–≤—Ç–∞
3 –æ–ø—Ü–∏–∏ –¥–µ–π—Å—Ç–≤–∏–π (—Å–º. –≤—ã—à–µ)
–ê–Ω–∏–º–∞—Ü–∏—è fade-in –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏
–ö–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Å –∏–∫–æ–Ω–∫–∞–º–∏


üîå API INTEGRATION
Request: POST /api/therapy
json
{
"session_id": "sess_abc123" || null,
"user_message": "–•–æ—á—É —Å—Ç–∞—Ä—Ç–∞–ø...",
"auth_token": "jwt_token_here"
}

Response: 200 OK
json
{
"session_id": "sess_abc123",
"therapist_message": "–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º—Å—è...",
"key_insights": [
{
"id": "ins_1",
"text": "–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Ü–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è",
"confidence": 0.85
}
],
"hypotheses": [
{
"id": "hyp_1",
"hypothesis_text": "–ù–∞—á–∞—Ç—å —Å Customer Discovery",
"reasoning": "–ù—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å –±–æ–ª–µ–≤—ã–µ —Ç–æ—á–∫–∏...",
"next_questions": ["–ö—Ç–æ –≤–∞—à –ø–µ—Ä–≤—ã–π customer?"],
"confidence": 0.9
}
],
"ready_for_board": true,
"conversation_turn": 1
}

Error Responses
400: Invalid session_id or user_message
401: Unauthorized (invalid token)
429: Rate limit exceeded
503: Backend service unavailable
500: Internal server error


üõ†Ô∏è INSTALLATION & USAGE
1. Frontend –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
bash
# –í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã
# –ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
# CSS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (link –≤ index.html)
# JS –º–æ–¥—É–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è (script –≤ index.html)

2. –í–∫–ª—é—á–µ–Ω–∏–µ Therapy —Ä–µ–∂–∏–º–∞
javascript
// –í –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º:
appState.setTherapyMode(true); // ‚Üí Therapy —Ä–µ–∂–∏–º
appState.setTherapyMode(false); // ‚Üí Board —Ä–µ–∂–∏–º

3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
javascript
appState.isTherapyMode(); // ‚Üí true/false
appState.getTherapySessionId(); // ‚Üí "sess_abc123"
appState.getTherapyInsights(); // ‚Üí [{id, text, confidence}]
appState.getTherapyHypotheses(); // ‚Üí [{id, text, reasoning, confidence}]



üîê SECURITY CONSIDERATIONS
Auth Token - –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∑–∞–ø—Ä–æ—Å–µ
Session ID - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –±—ç–∫–µ–Ω–¥–æ–º, –Ω–µ –¥–æ–≤–µ—Ä—è–µ–º –∫–ª–∏–µ–Ω—Ç—É
Input Sanitization - –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —ç–∫—Ä–∞–Ω–∏—Ä—É—é—Ç—Å—è
CORS - frontend –∏ backend –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ö–æ—Å—Ç–∞—Ö
Rate Limiting - –º–∞–∫—Å–∏–º—É–º 10 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É (backend side)


üì± RESPONSIVE DESIGN
Desktop (1200px+) - –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å 30% —à–∏—Ä–∏–Ω—ã
Tablet (768px-1199px) - –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å 40% —à–∏—Ä–∏–Ω—ã
Mobile (< 768px) - –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ bottom sheet


üåô DARK MODE SUPPORT
–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ç—ë–º–Ω—ã–π —Ä–µ–∂–∏–º:
CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ü–≤–µ—Ç–æ–≤
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ prefers-color-scheme
–ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å >= 4.5:1 –¥–ª—è —Ç–µ–∫—Å—Ç–∞


üìà METRICS & OBSERVABILITY
–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
javascript
logSafe('therapy message sent', {
sessionId: response.session_id,
insightsCount: response.key_insights?.length || 0,
hypothesesCount: response.hypotheses?.length || 0,
readyForBoard: response.ready_for_board
});

–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ —Å–æ–±—ã—Ç–∏—è
initTherapySession - –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è
therapySendToBoard - –ø–µ—Ä–µ—Ö–æ–¥ –≤ Board
therapyFormulateOwn - —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–∏–ø–æ—Ç–µ–∑—ã
therapyInsightDelete - —É–¥–∞–ª–µ–Ω–∏–µ insights
therapy message sent - —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å


üöß BACKEND PENDING
–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
‚úÖ Frontend Therapy –º–æ–¥—É–ª—å (–ì–û–¢–û–í)
üîÑ Backend /api/therapy endpoint (–ù–£–ñ–ù–ê –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø)
–¢–µ—Ä–∞–ø–µ–≤—Ç-–∞–≥–µ–Ω—Ç (GigaChat)
Insights —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä
Hypotheses –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
Session management
Response formatting
üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GigaChat
üîÑ –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ—Å—Å–∏–π (Redis/DB)
üîÑ E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ


üìù NOTES FOR DEVELOPERS
–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≥–∏–ø–æ—Ç–µ–∑—ã
javascript
// –ì–∏–ø–æ—Ç–µ–∑–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
{
id: "hyp_" + Date.now(),
hypothesis_text: "–ß–µ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è",
reasoning: "–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç",
next_questions: ["–í–æ–ø—Ä–æ—Å 1", "–í–æ–ø—Ä–æ—Å 2"],
confidence: 0.85
}

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ Insight
javascript
{
id: "ins_" + Date.now(),
text: "–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã/–∏–Ω—Å–∞–π—Ç–∞",
confidence: 0.8
}

Sending to Board
javascript
// –ü—Ä–∏–º–µ—Ä –≥–∏–ø–æ—Ç–µ–∑—ã –¥–ª—è Board:
"–ü—Ä–æ–≤–µ—Å—Ç–∏ Customer Discovery —Å 10 –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º–∏ users –ø–µ—Ä–µ–¥ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π MVP"



üéØ SUCCESS CRITERIA
‚úÖ Frontend –º–æ–¥—É–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
‚úÖ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ—Ç–∑—ã–≤—á–∏–≤—ã –∏ –∫—Ä–∞—Å–∏–≤—ã
‚úÖ Event listeners —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ API –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –±—ç–∫–µ–Ω–¥–æ–º
üîÑ Backend —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
üîÑ E2E workflow (Therapy ‚Üí Board) —Ä–∞–±–æ—Ç–∞–µ—Ç


üîó RELATED DOCUMENTATION
Architecture: /docs/clarity-feedback-loop.md
Board Module: /docs/board-module.md
API Spec: /docs/api-spec.md
Design System: /docs/design-system.md


üë§ AUTHOR & CONTRIBUTORS
Design & Frontend: @infoelard-creator
Backend: [TBD]
Testing: [TBD]


üìÖ TIMELINE
2026-01-06 - Frontend v1.0.0 Complete
[TBD] - Backend v1.0.0 Implementation
[TBD] - Integration Testing
[TBD] - Production Release


üìû SUPPORT & FEEDBACK
–í–æ–ø—Ä–æ—Å—ã? –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ [—Ç–µ—Ö. –∫–∞–Ω–∞–ª –ø—Ä–æ–µ–∫—Ç–∞]
Status: üü° FRONTEND READY, BACKEND PENDING